<app-buscador (buscar)="filtrar($event)"></app-buscador>

<div class="section-container">
  <div class="documents-header">
    <h2>{{ 'PROCEDURES_SECTION.TITLE' | translate }}</h2>

    <button
      class="jenkins-add-btn"
      *ngIf="canEdit"
      (click)="obrirPopupCrear()">
      <mat-icon inline="true">add</mat-icon>
      <span>Afegir procediment</span>
    </button>
  </div>

  <p>{{ 'PROCEDURES_SECTION.DESCRIPTION' | translate }}</p>

  <!-- Llista de procediments com a cards -->
  <div class="procedures-grid">
    <div *ngFor="let p of procedimientosFiltrados" class="procedure-card">

      <!-- cap√ßalera del bloc -->
      <div class="procedure-header">
        <h3 class="procedure-name">
          {{ p.titulo || '(Sense t√≠tol)' }}
        </h3>

        <span class="procedure-status">
          {{ 'PROCEDURES_SECTION.STATUS' | translate }}:
          {{ p.departamento || '-' }}
        </span>
      </div>

      <!-- cos del bloc -->
      <div class="procedure-responsible">
        {{ 'PROCEDURES_SECTION.RESPONSIBLE' | translate }}:
        {{ p.steps?.[0]?.responsable || '-' }}
      </div>

      <p class="procedure-desc" *ngIf="p.descripcion">
        {{ p.descripcion }}
      </p>

      <!-- accions CRUD a la dreta -->
      <div class="procedure-actions" *ngIf="canEdit">
        <button
          class="jenkins-add-btn"
          (click)="obrirPopupEditar(p)"
          title="Editar procedimiento">
          ‚úèÔ∏è
        </button>
        <button
          class="jenkins-add-btn cancel-btn"
          (click)="confirmarEliminar(p)"
          title="Eliminar procedimiento">
          üóëÔ∏è
        </button>
      </div>

    </div>
  </div>
</div>

<!-- Popup crear / editar -->
<div class="popup-fons" *ngIf="mostrarPopup" (click)="tancarPopup()">
  <div class="popup-container" (click)="$event.stopPropagation()">
    <h3>{{ editando ? 'Editar procedimiento' : 'Nuevo procedimiento' }}</h3>

    <div class="form-field">
      <label>T√≠tulo</label>
      <input
        type="text"
        [(ngModel)]="procForm.titulo"
        title="T√≠tulo del procedimiento" />
    </div>

    <div class="form-field">
      <label>Departamento (Estat)</label>
      <input
        type="text"
        [(ngModel)]="procForm.departamento"
        title="Departamento / Estado" />
    </div>

    <div class="form-field">
      <label>Responsable (primer pas)</label>
      <input
        type="text"
        [(ngModel)]="primerResponsable"
        title="Responsable principal" />
    </div>

    <div class="form-field">
      <label>Descripci√≥n</label>
      <textarea
        rows="3"
        [(ngModel)]="procForm.descripcion"
        title="Descripci√≥n del procedimiento">
      </textarea>
    </div>

    <div class="popup-actions">
      <button class="cancelar-btn" (click)="tancarPopup()">
        Cancelar
      </button>
      <button class="guardar-btn" (click)="guardarProcedimiento()">
        {{ editando ? 'Actualizar' : 'Guardar' }}
      </button>
    </div>
  </div>
</div>

<!-- Popup eliminar -->
<div class="popup-fons" *ngIf="mostrarPopupDelete" (click)="cancelarEliminar()">
  <div class="popup-container" (click)="$event.stopPropagation()">
    <h3>Eliminar procedimiento</h3>
    <p>¬øSeguro que quieres eliminar "{{ procAEliminar?.titulo || '(Sense t√≠tol)' }}"?</p>

    <div class="popup-actions">
      <button class="cancelar-btn" (click)="cancelarEliminar()">
        Cancelar
      </button>
      <button class="guardar-btn" (click)="eliminarProcedimiento()">
        Eliminar
      </button>
    </div>
  </div>
</div>
