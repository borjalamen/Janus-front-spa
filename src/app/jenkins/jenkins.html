<app-buscador (buscar)="filtrar($event)"></app-buscador>

<div class="section-container">
  <div class="documents-header">
    <h2>{{ 'JENKINS.TITLE' | translate }}</h2>

    <button
      class="jenkins-add-btn"
      *ngIf="canEditJenkins"
      (click)="openPopupForCreate()">
      <span>{{ 'JENKINS.ADD_BUTTON' | translate }}</span>
    </button>
  </div>

  <input
    type="file"
    #fileInput
    accept=".xml,.json,.txt"
    style="display: none"
    (change)="onJenkinsSelected($event)" />

  <!-- Grid de Jenkins como cards -->
  <div class="jenkins-grid">
    <div *ngFor="let jk of filteredJenkins" class="jenkins-card">

      <!-- Header de la card -->
      <div class="jenkins-header-card">
        <h3 class="jenkins-name">
          {{ jk.name || '(Sin nombre)' }}
        </h3>
      </div>

      <!-- Imagen de Jenkins -->
      <div class="jenkins-image-container">
        <a [href]="jk.url" target="_blank" rel="noopener noreferrer" (click)="$event.stopPropagation()">
          <img src="https://imgur.com/69aimFa.png" alt="{{ jk.name }}" class="jenkins-image" />
        </a>
      </div>

      <!-- URL -->
      <div class="jenkins-url">
        <a [href]="jk.url" target="_blank" rel="noopener noreferrer" (click)="$event.stopPropagation()">
          {{ jk.url }}
        </a>
      </div>

      <!-- Acciones CRUD dentro de la card -->
      <div class="jenkins-actions" *ngIf="canEditJenkins">
        <button
          class="jenkins-add-btn"
          (click)="openPopupForEdit(jk, $event)"
          title="Editar Jenkins">
          ‚úèÔ∏è
        </button>
        <button
          class="jenkins-add-btn cancel-btn"
          (click)="confirmDelete(jk)"
          title="Eliminar Jenkins">
          üóëÔ∏è
        </button>
      </div>

    </div>
  </div>
</div>

<!-- Popup afegir / editar Jenkins -->
<div class="popup-fons" *ngIf="popupOpen" (click)="closePopup()">
  <div
    class="popup-container"
    (click)="$event.stopPropagation()"
    (keyup.enter)="newName && newUrl && savePopup()"
    tabindex="0">
    <h3>
      {{
        editingJenkins
          ? ('JENKINS.POPUP_EDIT_TITLE' | translate)
          : ('JENKINS.POPUP_ADD_TITLE' | translate)
      }}
    </h3>

    <div class="form-field">
      <label>{{ 'JENKINS.FIELD_NAME_LABEL' | translate }}</label>
      <input
        type="text"
        [(ngModel)]="newName"
        [placeholder]="'JENKINS.FIELD_NAME_PLACEHOLDER' | translate"
        title="Nombre del Jenkins" />
    </div>

    <div class="form-field">
      <label>{{ 'JENKINS.FIELD_URL_LABEL' | translate }}</label>
      <input
        type="text"
        [(ngModel)]="newUrl"
        [placeholder]="'JENKINS.FIELD_URL_PLACEHOLDER' | translate"
        title="URL del Jenkins" />
    </div>

    <div class="popup-buttons">
      <button class="cancelar-btn" (click)="closePopup()" title="Cancelar">
        ‚úó
      </button>
      <button
        class="guardar-btn"
        (click)="savePopup()"
        [disabled]="!newName || !newUrl"
        [title]="editingJenkins ? 'Actualizar' : 'Guardar'">
        ‚úì
      </button>
    </div>
  </div>
</div>

<!-- Popup eliminar Jenkins -->
<div class="popup-fons" *ngIf="deletePopupOpen" (click)="cancelDelete()">
  <div
    class="popup-container"
    (click)="$event.stopPropagation()"
    tabindex="0">

    <h3>{{ 'JENKINS.DELETE_TITLE' | translate }}</h3>

    <p>{{ 'JENKINS.DELETE_MESSAGE' | translate }}</p>

    <div class="popup-buttons">
      <button class="cancelar-btn" (click)="cancelDelete()" title="Cancelar">
        ‚úó
      </button>
      <button class="guardar-btn" (click)="deleteJenkins()" title="Eliminar">
        ‚úì
      </button>
    </div>
  </div>
</div>
