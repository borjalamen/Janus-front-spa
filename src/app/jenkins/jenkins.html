<section class="jenkins-section">
  <div class="jenkins-container">
    <div class="jenkins-header">
      <h2 class="jenkins-title">{{ 'JENKINS.TITLE' | translate }}</h2>
      <div class="jenkins-buttons">
        <button
          class="jenkins-add-btn"
          type="button"
          (click)="openPopupForCreate()"
          *ngIf="canEditJenkins">
          {{ 'JENKINS.ADD_BUTTON' | translate }}
        </button>
        <button
          class="jenkins-add-btn"
          type="button"
          (click)="toggleDeleteMode()"
          *ngIf="canEditJenkins">
          {{
            deleteMode
              ? ('JENKINS.DELETE_BUTTON_ON' | translate)
              : ('JENKINS.DELETE_BUTTON_OFF' | translate)
          }}
        </button>
      </div>
    </div>

    <input
      type="file"
      #fileInput
      accept=".xml,.json,.txt"
      style="display: none"
      (change)="onJenkinsSelected($event)" />
  </div>

  <div class="jenkins-grid">
    <div
      class="jenkins-card"
      *ngFor="let jk of customJenkins"
      [ngClass]="{ 'selected': jk.selected }"
      (click)="deleteMode ? confirmDelete(jk) : openJenkins(jk, $event)">

      <div class="jenkins-info">
        <div class="jenkins-name">
          <strong>{{ jk.name }}</strong>
        </div>

        <a [href]="jk.url" target="_blank" rel="noopener noreferrer">
          <img src="https://imgur.com/69aimFa.png" alt="{{ jk.name }}" />
        </a>
      </div>

      <!-- Bot√≥ editar (nom√©s si es pot editar i no estem en deleteMode) -->
      <button
  title="Editar Jenkins"
  class="edit-icon"
  *ngIf="canEditJenkins && !deleteMode"
  (click)="openPopupForEdit(jk, $event)">
  <img src="assets/images/llapis.png" alt="Editar" class="edit-icon-img" />
</button>

      <div
        class="delete-icon"
        *ngIf="deleteMode"
        (click)="confirmDelete(jk); $event.stopPropagation()">
        üóëÔ∏è
      </div>
    </div>
  </div>

  <!-- Popup afegir / editar Jenkins -->
  <div class="popup-overlay" *ngIf="popupOpen" (click)="closePopup()">
    <div class="popup-box" (click)="$event.stopPropagation()">
      <h3>
        {{
          editingJenkins
            ? ('JENKINS.POPUP_EDIT_TITLE' | translate)
            : ('JENKINS.POPUP_ADD_TITLE' | translate)
        }}
      </h3>

      <label>{{ 'JENKINS.FIELD_NAME_LABEL' | translate }}</label>
      <input
        title="text"
        type="text"
        [(ngModel)]="newName"
        class="popup-input"
        [placeholder]="'JENKINS.FIELD_NAME_PLACEHOLDER' | translate" />

      <label>{{ 'JENKINS.FIELD_URL_LABEL' | translate }}</label>
      <input
        title="text"
        type="text"
        [(ngModel)]="newUrl"
        class="popup-input"
        [placeholder]="'JENKINS.FIELD_URL_PLACEHOLDER' | translate" />

      <div class="popup-buttons">
        <button class="cancel-btn" (click)="closePopup()">
          {{ 'JENKINS.CANCEL' | translate }}
        </button>
        <button
          class="save-btn"
          (click)="savePopup()"
          [disabled]="!newName || !newUrl">
          {{
            editingJenkins
              ? ('JENKINS.UPDATE' | translate)
              : ('JENKINS.SAVE' | translate)
          }}
        </button>
      </div>
    </div>
  </div>

  <!-- Popup eliminar Jenkins -->
  <div class="popup-overlay" *ngIf="deletePopupOpen" (click)="cancelDelete()">
    <div class="popup-box" (click)="$event.stopPropagation()">
      <h3>{{ 'JENKINS.DELETE_TITLE' | translate }}</h3>

      <p>{{ 'JENKINS.DELETE_MESSAGE' | translate }}</p>

      <div class="popup-buttons">
        <button class="cancel-btn" (click)="cancelDelete()">
          {{ 'JENKINS.CANCEL' | translate }}
        </button>
        <button class="save-btn" (click)="deleteJenkins()">
          {{ 'JENKINS.DELETE_ACTION' | translate }}
        </button>
      </div>
    </div>
  </div>
</section>
