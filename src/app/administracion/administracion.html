<app-buscador (buscar)="filtrar($event)"></app-buscador>

<div class="section-container documents-wrapper">
  <div class="documents-header">
    <h2>{{ 'USERS.TITLE' | translate }}</h2>

    <div style="display: flex; gap: 12px;">
      <!-- Afegir usuari nomÃ©s per admin/devops -->
      <button
        class="jenkins-add-btn"
        *ngIf="canEdit"
        (click)="obrirPopupCrear()">
        <mat-icon inline="true">add</mat-icon>
        <span>{{ 'USERS.ADD_BUTTON' | translate }}</span>
      </button>
    </div>
  </div>

  <div>
    <div
      *ngFor="let usuari of usuarisFiltrats"
      class="usuari-item"
      style="margin-bottom:12px; display:flex; justify-content:space-between; align-items:center;">

      <div>
        <div class="usuari-nom">
          <b>{{ usuari.fullName }}</b>
          <span class="usuari-rol">
            ({{ usuari.roles.join(', ') }})
          </span>
        </div>
        <div class="usuari-email">{{ usuari.email }}</div>
      </div>

      <!-- Accions CRUD nomÃ©s si canEdit -->
      <div style="display:flex; gap:8px;" *ngIf="canEdit">
        <button
          class="jenkins-add-btn"
          (click)="obrirPopupEditar(usuari)"
          title="Editar usuari">
          âœï¸
        </button>
        <button
          class="jenkins-add-btn cancel-btn"
          (click)="confirmarEsborrar(usuari)"
          title="Eliminar usuari">
          ğŸ—‘ï¸
        </button>
      </div>
<<<<<<< Updated upstream
=======

      <app-buscador (buscar)="filtrar($event)" style="margin-bottom: 20px; display: block;"></app-buscador>

      <div class="users-list">
        <div *ngFor="let usuari of usuarisFiltrats" class="usuari-item">
          <div>
            <div class="usuari-nom">
              <b>{{ usuari.fullName }}</b>
              <span class="usuari-rol">({{ usuari.roles.join(', ') }})</span>
            </div>
            <div class="usuari-email">{{ usuari.email }}</div>
          </div>

          <div class="actions" *ngIf="canEdit">
            <button class="jenkins-add-btn" (click)="obrirPopupEditar(usuari)" title="Actualizar usuario">
              âœï¸
            </button>
            <button class="jenkins-add-btn cancel-btn" (click)="confirmarInhabilitar(usuari)" title="Inhabilitar usuario">
              ğŸ—‘ï¸
            </button>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="activeTab === 'APP'" class="tab-content fade-in">
      <div class="documents-header">
        <h2>Administrar AplicaciÃ³n</h2>
      </div>
      
      <div class="admin-card">
        <h3>ğŸš« Inhabilitar por roles</h3>
        <p>Seleccione un rol para restringir el acceso temporalmente a la aplicaciÃ³n.</p>
        
        <div class="form-field-modern">
            <label>Seleccionar Rol:</label>
            <select [(ngModel)]="selectedRoleToDisable" class="modern-select">
                <option value="" disabled selected>-- Elegir --</option>
                <option value="CONSULTOR">ğŸ‘” Consultor</option>
                <option value="DEV">âš™ï¸ DevOps</option>
            </select>
        </div>
        
        <div style="margin-top: 20px; text-align: right;">
            <button class="jenkins-add-btn" (click)="inhabilitarPorRol()">
                ğŸ”’ Inhabilitar Acceso
            </button>
        </div>
      </div>
    </div>

    <div *ngIf="activeTab === 'PARAM'" class="tab-content fade-in">
      <div class="documents-header">
        <h2>ParametrizaciÃ³n</h2>
      </div>

      <div class="admin-card">
        <h3>ğŸ“¦ Cambio de versiÃ³n</h3>
        <p>GestiÃ³n de la versiÃ³n actual del despliegue.</p>
        
        <div class="form-field-modern">
            <label>VersiÃ³n del Sistema:</label>
            <input type="text" [(ngModel)]="appVersion" class="modern-input" placeholder="Ej: 1.0.0">
        </div>

        <div style="margin-top: 20px; text-align: right;">
            <button class="jenkins-add-btn" (click)="cambiarVersion()">
                ğŸ”„ Actualizar VersiÃ³n
            </button>
        </div>
      </div>
    </div>

    <div *ngIf="activeTab === 'DB'" class="tab-content fade-in">
      <div class="documents-header">
        <h2>AdministraciÃ³n de la BBDD</h2>
      </div>

      <div class="db-grid">
        <div class="admin-card db-card">
            <div class="big-icon warn">ğŸ—‘ï¸</div>
            <h3>Borrado FÃ­sico</h3>
            <p>Elimina permanentemente registros marcados.</p>
            <button class="jenkins-add-btn cancel-btn" (click)="accionBBDD('borrado')">Ejecutar</button>
        </div>

        <div class="admin-card db-card">
            <div class="big-icon">â™»ï¸</div>
            <h3>Restore</h3>
            <p>Restaura la base de datos a un punto anterior.</p>
            <button class="jenkins-add-btn" (click)="accionBBDD('restore')">Restaurar</button>
        </div>

        <div class="admin-card db-card">
            <div class="big-icon">ğŸ’¾</div>
            <h3>Backup</h3>
            <p>Genera una copia de seguridad actual.</p>
            <button class="jenkins-add-btn" (click)="accionBBDD('backup')">Crear Backup</button>
        </div>
      </div>
    </div>

  </div>
</div>
<div class="popup-fons" *ngIf="mostrarPopup" (click)="tancarPopup()">
  <div class="popup-container" (click)="$event.stopPropagation()">
    <h3>{{ usuariEditant ? 'Modificar Usuario' : 'Nuevo Usuario' }}</h3>

    <div class="form-field">
      <label>Nombre</label>
      <input type="text" [(ngModel)]="nouUsuari.nombre" placeholder="jlopez">
    </div>

    <div class="form-field">
      <label>Email</label>
      <input type="email" [(ngModel)]="nouUsuari.email" placeholder="jlopez@minsait.com">
    </div>

    <div class="form-field">
      <label>ContraseÃ±a</label>
      <input type="password" [(ngModel)]="nouUsuari.contrasenya" placeholder="{{ usuariEditant ? 'Dejar vacÃ­o para mantener' : 'Introduce contraseÃ±a' }}">
    </div>

    <div class="form-field">
      <label>Roles del Usuario:</label>
      <div class="roles-buttons">
        <button type="button" 
                class="role-btn" 
                [class.active]="nouUsuari.rols.admin" 
                (click)="nouUsuari.rols.admin = !nouUsuari.rols.admin">
          ğŸ‘‘ Administrador
        </button>
        <button type="button" 
                class="role-btn" 
                [class.active]="nouUsuari.rols.consultor" 
                (click)="nouUsuari.rols.consultor = !nouUsuari.rols.consultor">
          ğŸ‘” Consultor
        </button>
        <button type="button" 
                class="role-btn" 
                [class.active]="nouUsuari.rols.devops" 
                (click)="nouUsuari.rols.devops = !nouUsuari.rols.devops">
          âš™ï¸ DevOps
        </button>
      </div>
    </div>

    <div class="popup-actions">
      <button class="cancelar-btn" (click)="tancarPopup()" title="Cancelar">
        âœ—
      </button>
      <button class="guardar-btn" (click)="guardarUsuari()" [title]="usuariEditant ? 'Actualizar' : 'Guardar'">
        âœ“
      </button>
>>>>>>> Stashed changes
    </div>
  </div>
</div>

<<<<<<< Updated upstream
<!-- Popup crear / editar -->
<div class="popup-fons" *ngIf="mostrarPopup">
  <div class="popup-container">
    <h3>
      {{
        usuariEditant
          ? ('USERS.EDIT_POPUP_TITLE' | translate)
          : ('USERS.ADD_POPUP_TITLE' | translate)
      }}
    </h3>

    <div class="form-field">
      <label>{{ 'USERS.FIELD_NAME' | translate }}</label>
      <input
        type="text"
        [(ngModel)]="nouUsuari.nombre"
        title="Nombre de usuario" />
    </div>

    <div class="form-field">
      <label>{{ 'USERS.FIELD_PASSWORD' | translate }}</label>
      <input
        type="password"
        [(ngModel)]="nouUsuari.contrasenya"
        title="ContraseÃ±a del usuario" />
    </div>

    <div class="form-field">
      <label>{{ 'USERS.FIELD_EMAIL' | translate }}</label>
      <input
        type="email"
        [(ngModel)]="nouUsuari.email"
        title="Correo electrÃ³nico" />
    </div>

    <div class="form-field">
      <label>
        <input
          type="checkbox"
          [(ngModel)]="nouUsuari.rols.admin"
          title="Rol administrador" />
        {{ 'USERS.ROLE_ADMIN' | translate }}
      </label>
      <label>
        <input
          type="checkbox"
          [(ngModel)]="nouUsuari.rols.consultor"
          title="Rol consultor" />
        {{ 'USERS.ROLE_CONSULTOR' | translate }}
      </label>
      <label>
        <input
          type="checkbox"
          [(ngModel)]="nouUsuari.rols.devops"
          title="Rol DevOps" />
        {{ 'USERS.ROLE_DEVOPS' | translate }}
      </label>
    </div>

    <div class="popup-actions" style="margin-top: 12px;">
      <button class="jenkins-add-btn cancel-btn" (click)="tancarPopup()">
        {{ 'USERS.CANCEL' | translate }}
      </button>
      <button class="jenkins-add-btn" (click)="guardarUsuari()">
        {{
          usuariEditant
            ? ('USERS.UPDATE' | translate)
            : ('USERS.SAVE' | translate)
        }}
=======
<!-- Popup confirmaciÃ³n eliminar usuario -->
<div class="popup-fons" *ngIf="mostrarPopupDelete" (click)="cancelarInhabilitar()">
  <div class="popup-container" (click)="$event.stopPropagation()">
    <h3>Eliminar Usuario</h3>
    <p>Â¿EstÃ¡s seguro de que quieres eliminar al usuario <strong>{{ usuariAEsborrar?.fullName }}</strong>?</p>
    <p style="color: #ff6b6b; font-size: 0.9em;">Esta acciÃ³n no se puede deshacer.</p>

    <div class="popup-actions">
      <button class="cancelar-btn" (click)="cancelarInhabilitar()" title="Cancelar">
        âœ—
      </button>
      <button class="guardar-btn" (click)="inhabilitarUsuari()" title="Eliminar">
        âœ“
>>>>>>> Stashed changes
      </button>
    </div>
  </div>
</div>

<!-- Popup confirmar esborrat -->
<div class="popup-fons" *ngIf="mostrarPopupDelete && usuariAEsborrar">
  <div class="popup-container">
    <h3>{{ 'USERS.DELETE_TITLE' | translate }}</h3>
    <p>
      {{
        'USERS.DELETE_MESSAGE'
          | translate:{ name: usuariAEsborrar.fullName }
      }}
    </p>

    <div class="popup-actions" style="margin-top: 12px;">
      <button class="jenkins-add-btn cancel-btn" (click)="cancelarEsborrar()">
        {{ 'USERS.CANCEL' | translate }}
      </button>
      <button class="jenkins-add-btn" (click)="esborrarUsuari()">
        {{ 'USERS.DELETE_ACTION' | translate }}
      </button>
    </div>
  </div>
</div>
