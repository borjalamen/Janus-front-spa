<div class="project-detail-root">
  <div class="project-detail-header">
    <div class="header-spacer"></div>
    <button class="back-icon top-right" title="{{ 'PROJECTS.CLOSE' | translate }}" (click)="back()">
      <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path d="M15 6L9 12L15 18" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
  </div>

  <div *ngIf="!proyecto">{{ 'PROJECTS.NOT_FOUND' | translate }}</div>

  <div *ngIf="proyecto" class="project-section">
    <div class="project-title">
      <span class="project-code">{{ proyecto.codigoProyecto }}</span>
      <span class="sep"> | </span>
      <span class="project-name">{{ proyecto.nombre }}</span>
    </div>

    <!-- Tabs -->
    <div class="tabs" role="tablist" aria-label="{{ 'PROJECTS.TABS_ARIA' | translate }}">
      <button class="tab" [class.active]="activeTab==='info'" (click)="activeTab='info'" role="tab" [attr.aria-selected]="activeTab==='info'">{{ 'PROJECTS.TAB_INFO' | translate }}</button>
      <button class="tab" [class.active]="activeTab==='docs'" (click)="activeTab='docs'" role="tab" [attr.aria-selected]="activeTab==='docs'">{{ 'PROJECTS.TAB_DOCS' | translate }}</button>
    </div>

    <!-- Info tab -->
    <div *ngIf="activeTab==='info'">
      <div class="sections-container">

        <!-- Datos generales (naranja) -->
        <section class="section section-general">
          <div class="section-title">{{ 'PROJECTS.SECTION_GENERAL' | translate }}</div>
          <div class="project-form-grid full-width">
            <div class="general-grid three-col">
              <div class="form-row"><label>{{ 'PROJECTS.CODE' | translate }}</label>
                <input [(ngModel)]="proyecto.codigoProyecto" placeholder="{{ 'PROJECTS.CODE_PLACEHOLDER' | translate }}" [readonly]="!editing" />
              </div>

              <div class="form-row"><label>{{ 'PROJECTS.NAME' | translate }}</label>
                <input [(ngModel)]="proyecto.nombre" placeholder="{{ 'PROJECTS.NAME_PLACEHOLDER' | translate }}" [readonly]="!editing" />
              </div>

              <div class="form-row"><label>{{ 'PROJECTS.CODIGO_IMPUTACION' | translate }}</label>
                <input [(ngModel)]="proyecto.codigoImputacion" placeholder="" [readonly]="!editing" />
              </div>

              <div class="form-row"><label>{{ 'PROJECTS.RESPONSABLE' | translate }}</label>
                <input [(ngModel)]="proyecto.responsableProyecto" placeholder="{{ 'PROJECTS.RESPONSABLE' | translate }}" [readonly]="!editing" />
              </div>

              <div class="form-row"><label>{{ 'PROJECTS.RESPONSABLE_TEC' | translate }}</label>
                <input [(ngModel)]="proyecto.responsableTecnico" placeholder="{{ 'PROJECTS.RESPONSABLE_TEC' | translate }}" [readonly]="!editing" />
              </div>

              <div class="form-row"><label>{{ 'PROJECTS.HORA_DAILY' | translate }}</label>
                <input type="time" [(ngModel)]="proyecto.horaDaily" [readonly]="!editing" />
              </div>

              <div class="form-row"><label>{{ 'PROJECTS.LOTE' | translate }}</label>
                <input [(ngModel)]="proyecto.lote" placeholder="{{ 'PROJECTS.LOTE_PLACEHOLDER' | translate }}" [readonly]="!editing" />
              </div>

              <div class="form-row"><label>{{ 'PROJECTS.DEPARTMENT' | translate }}</label>
                <input [(ngModel)]="proyecto.departamento" placeholder="{{ 'PROJECTS.DEPARTMENT_PLACEHOLDER' | translate }}" [readonly]="!editing" />
              </div>

            </div>
          </div>
          <div class="divider" aria-hidden="true"></div>
          <div class="urls-grid">
            <div class="form-row"><label>{{ 'PROJECTS.URL_ENTORNO_DESARROLLO' | translate }}</label>
              <input [(ngModel)]="proyecto.urlEntornoDesarrollo" placeholder="https://..." [readonly]="!editing" />
            </div>
            <div class="form-row"><label>{{ 'PROJECTS.URL_ENTORNO_INTEGRACION' | translate }}</label>
              <input [(ngModel)]="proyecto.urlEntornoIntegracion" placeholder="https://..." [readonly]="!editing" />
            </div>
            <div class="form-row"><label>{{ 'PROJECTS.URL_ENTORNO_PREPROD' | translate }}</label>
              <input [(ngModel)]="proyecto.urlEntornoPreproduccion" placeholder="https://..." [readonly]="!editing" />
            </div>
            <div class="form-row"><label>{{ 'PROJECTS.URL_ENTORNO_PRODUCCION' | translate }}</label>
              <input [(ngModel)]="proyecto.urlEntornoProduccion" placeholder="https://..." [readonly]="!editing" />
            </div>
          </div>
        </section>

        <!-- Entorno de desarrollo (verde) -->
        <section class="section section-dev">
          <div class="section-title">{{ 'PROJECTS.SECTION_DEV' | translate }}</div>
          <div class="form-col wide">
            <div class="form-row">
              <label>{{ 'PROJECTS.DEV_MACHINES' | translate }}</label>
              <div class="dev-machines">
                <div class="dev-machine-card" *ngFor="let m of devMachines; let i = index">
                  <div class="dev-card-top">
                    <div class="dev-fields grid-3">
                      <div class="field">
                        <label>{{ 'PROJECTS.DEV_IP' | translate }}</label>
                        <input [(ngModel)]="m.ip" placeholder="{{ 'PROJECTS.PLACEHOLDER_IP' | translate }}" />
                      </div>
                      <div class="field">
                        <label>{{ 'PROJECTS.DEV_USER' | translate }}</label>
                        <input [(ngModel)]="m.user" placeholder="{{ 'PROJECTS.PLACEHOLDER_USER' | translate }}" />
                      </div>
                      <div class="field">
                        <label>{{ 'PROJECTS.DEV_PASSWORD' | translate }}</label>
                        <input [(ngModel)]="m.password" placeholder="{{ 'PROJECTS.PLACEHOLDER_PASSWORD' | translate }}" type="password" />
                      </div>
                    </div>
                    <div class="dev-actions">
                      <button class="btn small danger" (click)="removeDevMachine(i)">-</button>
                    </div>
                  </div>

                  <div class="dev-resources grid-3 compact">
                    <div class="field"><label>{{ 'PROJECTS.DEV_RAM' | translate }}</label><input [(ngModel)]="m.ram" placeholder="e.g. 4GB" /></div>
                    <div class="field"><label>{{ 'PROJECTS.DEV_CPU' | translate }}</label><input [(ngModel)]="m.cpu" placeholder="e.g. 2" /></div>
                    <div class="field"><label>{{ 'PROJECTS.DEV_DISK' | translate }}</label><input [(ngModel)]="m.disk" placeholder="e.g. 40GB" /></div>
                  </div>

                  <div class="openshift-row">
                    <div class="openshift-toggle">
                      <label class="switch">
                        <input type="checkbox" [(ngModel)]="m.openshiftEnabled" />
                        <span class="slider"></span>
                      </label>
                      <span class="switch-label">{{ 'PROJECTS.OPENSHIFT' | translate }}</span>
                    </div>
                  </div>

                  <div class="openshift-section" *ngIf="m.openshiftEnabled">
                    <div class="openshift-grid">
                      <div class="field"><label>{{ 'PROJECTS.OPENSHIFT_USER' | translate }}</label><input [(ngModel)]="m.openshift!.user" /></div>
                      <div class="field"><label>{{ 'PROJECTS.OPENSHIFT_PASSWORD' | translate }}</label><input [(ngModel)]="m.openshift!.password" type="password" /></div>
                      <div class="field"><label>{{ 'PROJECTS.DEV_RAM' | translate }}</label><input [(ngModel)]="m.openshift!.ram" placeholder="e.g. 4GB" /></div>
                      <div class="field"><label>{{ 'PROJECTS.DEV_CPU' | translate }}</label><input [(ngModel)]="m.openshift!.cpu" placeholder="e.g. 2" /></div>
                      <div class="field"><label>{{ 'PROJECTS.DEV_DISK' | translate }}</label><input [(ngModel)]="m.openshift!.disk" placeholder="e.g. 40GB" /></div>
                    </div>
                    <div class="form-row volumes-row">
                      <label>{{ 'PROJECTS.VOLUMES' | translate }}</label>
                      <div class="volumes-list">
                        <div class="volume" *ngFor="let v of (m.openshift!.volumes || []); let vi = index">
                          <div class="field">
                            <label>{{ 'PROJECTS.VOLUME_NAME' | translate }}</label>
                            <input [(ngModel)]="v.name" placeholder="{{ 'PROJECTS.VOLUME_NAME_PLACEHOLDER' | translate }}" />
                          </div>
                          <div class="field">
                            <label>{{ 'PROJECTS.VOLUME_CAPACITY' | translate }}</label>
                            <input [(ngModel)]="v.capacity" placeholder="{{ 'PROJECTS.VOLUME_CAPACITY_PLACEHOLDER' | translate }}" />
                          </div>
                          <button class="btn small danger" (click)="removeVolume(i, vi)">-</button>
                        </div>
                        <div>
                          <button class="btn small" (click)="addVolume(i)">+ {{ 'PROJECTS.ADD_VOLUME' | translate }}</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="add-dev-row">
                <button class="btn small" (click)="addDevMachine()">+ {{ 'PROJECTS.ADD_DEV_MACHINE' | translate }}</button>
              </div>
            </div>
            <div class="form-row">
              <label>{{ 'PROJECTS.NOTES' | translate }}</label>
              <textarea [(ngModel)]="proyecto.entornoNotas" rows="4" placeholder="{{ 'PROJECTS.NOTES_PLACEHOLDER' | translate }}"></textarea>
            </div>
          </div>

        <!-- Herramientas MIND (turquesa) -->
        <section class="section section-mind">
          <div class="mind-card">
            <div class="mind-card-header">
              <h3>{{ 'PROJECTS_MIND.TITLE' | translate }}</h3>
            </div>
            <div class="mind-card-body">
              <div class="mind-grid">
                <div class="mind-col">
                  <label>{{ 'PROJECTS_MIND.BITBUCKET' | translate }}</label>
                  <ng-container *ngIf="editing">
                    <input [(ngModel)]="hm.bitbucket" />
                  </ng-container>
                  <ng-container *ngIf="!editing">
                    <a *ngIf="isValidUrl(hm.bitbucket)" (click)="openUrl(hm.bitbucket)" class="mind-link">{{ hm.bitbucket }}</a>
                    <span *ngIf="!isValidUrl(hm.bitbucket)">{{ hm.bitbucket }}</span>
                  </ng-container>
                </div>

                <div class="mind-col">
                  <label>{{ 'PROJECTS_MIND.NEXUS' | translate }}</label>
                  <ng-container *ngIf="editing">
                    <textarea [(ngModel)]="nexusString" rows="3" placeholder="{{ 'PROJECTS.PLACEHOLDER_NEXUS' | translate }}"></textarea>
                  </ng-container>
                  <ng-container *ngIf="!editing">
                    <textarea readonly rows="3" [value]="(hm.nexus || []).join('\n')" class="mind-readonly-textarea"></textarea>
                  </ng-container>
                </div>

                <div class="mind-col">
                  <label>{{ 'PROJECTS_MIND.SONAR' | translate }}</label>
                  <input placeholder="{{ 'PROJECTS.PLACEHOLDER_SONAR_PREFIX' | translate }}" [(ngModel)]="hm.sonar.prefix" [readonly]="!editing" />
                  <input placeholder="{{ 'PROJECTS.PLACEHOLDER_SONAR_URL' | translate }}" [(ngModel)]="hm.sonar.url" [readonly]="!editing" />
                  <input placeholder="{{ 'PROJECTS.PLACEHOLDER_SONAR_USER' | translate }}" [(ngModel)]="hm.sonar.tokenUser" [readonly]="!editing" />
                  <input placeholder="{{ 'PROJECTS.PLACEHOLDER_SONAR_TOKEN' | translate }}" [(ngModel)]="hm.sonar.tokenValue" [readonly]="!editing" />
                </div>

                <div class="mind-col">
                  <label>{{ 'PROJECTS_MIND.JENKINS' | translate }}</label>
                  <input [(ngModel)]="hm.jenkins" [readonly]="!editing" />
                  <label>{{ 'PROJECTS_MIND.CRONTAB' | translate }}</label>
                  <input [(ngModel)]="hm.crontab" [readonly]="!editing" />
                </div>
              </div>
            </div>
          </div>
        </section>
        </section>
      </div>
    </div>

    <!-- Docs tab -->
    <div *ngIf="activeTab==='docs'">
      <div class="sections-container">
        <section class="section section-general">
          <div class="section-title">{{ 'PROJECTS.TAB_DOCS' | translate }}</div>
          <div class="project-form-grid full-width">
            <div class="form-row">
              <label>{{ 'PROJECTS.DOCUMENTATION_LABEL' | translate }}</label>
              <textarea [(ngModel)]="docsString" rows="10" placeholder="{{ 'PROJECTS.PLACEHOLDER_DOCUMENTATION' | translate }}" [readonly]="!editing"></textarea>
            </div>
          </div>
        </section>
      </div>
    </div>

    <div class="actions">
      <button class="jh-btn" *ngIf="!editing && routeMode==='edit'" (click)="editing=true">{{ 'PROJECTS.EDIT' | translate }}</button>
      <button class="jh-btn" *ngIf="editing" (click)="save()">{{ 'PROJECTS.SAVE' | translate }}</button>
    </div>
  </div>
</div>
