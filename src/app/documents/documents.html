<app-buscador (buscar)="filtrar($event)"></app-buscador>

<div class="section-container documents-wrapper">
  <div class="documents-header">
    <h2>{{ 'DOCUMENTS.TITLE' | translate }}</h2>
    <button mat-raised-button class="jenkins-add-btn" (click)="toggleAddPopup()">
      <mat-icon inline="true">add</mat-icon>
      <span>{{ 'DOCUMENTS.ADD_BUTTON' | translate }}</span>
    </button>
  </div>

  <div class="projects-list">
    <div *ngFor="let project of projectsFiltrats" class="project-container">
      <mat-icon class="project-folder">folder</mat-icon>

      <div class="project-info">
        <div class="project-header-line">
          <div class="project-id">
            <strong>{{ 'DOCUMENTS.PROJECT_ID' | translate }}</strong> {{ project.projectId }}
          </div>
          <div class="project-name">
            <strong>{{ 'DOCUMENTS.PROJECT_NAME' | translate }}</strong> {{ project.name }}
          </div>
        </div>

        <div *ngIf="project.documents?.length">
          <div *ngFor="let doc of project.documents" class="document-item">
            <div class="doc-left">
              <mat-icon>description</mat-icon>
              <span>{{ doc.name }} - {{ doc.date }}</span>
            </div>

            <button
              mat-icon-button
              color="warn"
              class="delete-doc-btn"
              (click)="confirmDeleteDocument(project, doc)">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Popup afegir document -->
<div class="add-document-backdrop" *ngIf="showAddPopup" (click)="toggleAddPopup()">
  <div class="add-document-popup" (click)="$event.stopPropagation()">
    <h3>{{ 'DOCUMENTS.ADD_POPUP_TITLE' | translate }}</h3>

    <div class="popup-field">
      <label>{{ 'DOCUMENTS.FIELD_PROJECT_ID' | translate }}</label>
      <input type="number" [(ngModel)]="projectId" title="numero" />
    </div>

    <div class="popup-field">
      <label>{{ 'DOCUMENTS.FIELD_DOC_NAME' | translate }}</label>

      <input
        type="text"
        [(ngModel)]="name"
        style="width: 100%; margin-bottom: 4px;"
        title="text" />

      <button
        mat-raised-button
        class="examinar-btn"
        type="button"
        (click)="fileInput.click()">
        {{ 'DOCUMENTS.BROWSE' | translate }}
      </button>

      <input
        type="file"
        #fileInput
        style="display: none;"
        (change)="onFileSelected($event)" />
    </div>

    <div class="popup-actions">
      <button mat-raised-button class="examinar-btn" (click)="addDocument()">
        {{ 'DOCUMENTS.SAVE' | translate }}
      </button>
      <button mat-raised-button class="examinar-btn" (click)="toggleAddPopup()">
        {{ 'DOCUMENTS.CANCEL' | translate }}
      </button>
    </div>
  </div>
</div>

<!-- Popup eliminar DOCUMENT -->
<div
  class="add-document-backdrop"
  *ngIf="deleteDocPopupOpen && docToDelete"
  (click)="cancelDeleteDocument()">
  <div class="add-document-popup" (click)="$event.stopPropagation()">
    <h3>{{ 'DOCUMENTS.DELETE_DOC_TITLE' | translate }}</h3>
    <p>
      {{
        'DOCUMENTS.DELETE_DOC_QUESTION'
          | translate:{ name: docToDelete.document.name }
      }}
    </p>
    <div class="popup-actions">
      <button mat-raised-button class="guardar-btn" (click)="deleteDocument()">
        {{ 'DOCUMENTS.DELETE' | translate }}
      </button>
      <button
        mat-raised-button
        class="cancelar-btn"
        (click)="cancelDeleteDocument()">
        {{ 'DOCUMENTS.CANCEL' | translate }}
      </button>
    </div>
  </div>
</div>

<!-- Popup eliminar PROJECTE -->
<div
  class="add-document-backdrop"
  *ngIf="deleteProjectPopupOpen && projectToDelete"
  (click)="cancelDeleteProject()">
  <div class="add-document-popup" (click)="$event.stopPropagation()">
    <h3>{{ 'DOCUMENTS.DELETE_PROJECT_TITLE' | translate }}</h3>
    <p>
      {{
        'DOCUMENTS.DELETE_PROJECT_QUESTION'
          | translate:{ name: projectToDelete.name }
      }}
    </p>
    <div class="popup-actions">
      <button mat-raised-button class="guardar-btn" (click)="deleteProject()">
        {{ 'DOCUMENTS.DELETE' | translate }}
      </button>
      <button
        mat-raised-button
        class="cancelar-btn"
        (click)="cancelDeleteProject()">
        {{ 'DOCUMENTS.CANCEL' | translate }}
      </button>
    </div>
  </div>
</div>
